/*
 * THIS IS A GENERATED FILE!  DO NOT CHANGE THIS FILE!  CHANGE THE
 * CORRESPONDING TEMPLATE FILE, PLEASE!
 */

#include <shogun/base/SGObject.h>
#include <shogun/base/class_list.h>
#include <shogun/io/SerializableJsonFile.h>
#include <unistd.h>
#include <gtest/gtest.h>

using namespace shogun;

#ifdef HAVE_JSON

{% for class in classes %}
TEST(SerializationJSON, {{class}})
{
	std::string class_name("{{class}}");
	std::string file_template = "/tmp/" + class_name + ".XXXXXX";
	char* filename = mktemp(const_cast<char*>(file_template.c_str()));
	CSGObject* object = new_sgserializable(class_name.c_str(), PT_NOT_GENERIC);
	ASSERT_TRUE(object != NULL);

	// save object to an ascii file
	CSerializableJsonFile *file=new CSerializableJsonFile(filename, 'w');
	object->save_serializable(file);
	file->close();
	SG_UNREF(file);

	// load parameter from an ascii file
	file=new CSerializableJsonFile(filename, 'r');
	CSGObject* deserializedObject = new_sgserializable(class_name.c_str(), PT_NOT_GENERIC);
	ASSERT_TRUE(deserializedObject != NULL);
	deserializedObject->load_serializable(file);
	file->close();
	SG_UNREF(file);

	// check whether they are equal
	ASSERT_TRUE(object->equals(deserializedObject));
	
	SG_UNREF(object)
	SG_UNREF(deserializedObject);
}
{% endfor %}

{% for class in template_classes %}
{% for type in types %}
TEST(SerializationJSON,{{class}}_{{type}})
{
	std::string class_name("{{class}}");
	std::string file_template = "/tmp/" + class_name + "_{{type}}" + ".XXXXXX";
	char* filename = mktemp(const_cast<char*>(file_template.c_str()));
	CSGObject* object = new_sgserializable(class_name.c_str(), {{type}});
	ASSERT_TRUE(object != NULL);

	// save object to an ascii file
	CSerializableJsonFile *file=new CSerializableJsonFile(filename, 'w');
	object->save_serializable(file);
	file->close();
	SG_UNREF(file);

	// load parameter from an ascii file
	file=new CSerializableJsonFile(filename, 'r');
	CSGObject* deserializedObject = new_sgserializable(class_name.c_str(), {{type}});
	ASSERT_TRUE(deserializedObject != NULL);
	deserializedObject->load_serializable(file);
	file->close();
	SG_UNREF(file);

	// check whether they are equal
	ASSERT_TRUE(object->equals(deserializedObject));
	
	SG_UNREF(object)
	SG_UNREF(deserializedObject);

}
{% endfor %}
{% endfor %}

#endif /* HAVE_JSON */
